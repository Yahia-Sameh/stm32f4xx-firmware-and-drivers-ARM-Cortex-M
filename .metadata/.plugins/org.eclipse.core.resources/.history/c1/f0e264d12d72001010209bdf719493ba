/*
 * led_matrix.h
 *
 *  Created on: Aug 5, 2025
 *      Author: cgame
 */

#ifndef LED_MATRIX_H_
#define LED_MATRIX_H_

#ifndef LED_MATRIX_H
#define LED_MATRIX_H

#include "stm32f4xx_hal.h"

#define MATRIX_ROWS 8
#define MATRIX_COLS 8

typedef struct {
    GPIO_TypeDef* row_ports[MATRIX_ROWS];
    uint16_t row_pins[MATRIX_ROWS];
    GPIO_TypeDef* col_ports[MATRIX_COLS];
    uint16_t col_pins[MATRIX_COLS];
    uint8_t buffer[MATRIX_ROWS];
    TIM_HandleTypeDef* refresh_timer;
    uint8_t current_row;
    uint8_t brightness;
} LED_Matrix;

// Initialize LED matrix
void LEDMX_Init(LED_Matrix* matrix, TIM_HandleTypeDef* refresh_timer);

// Clear the entire matrix
void LEDMX_Clear(LED_Matrix* matrix);

// Set a single pixel state
void LEDMX_SetPixel(LED_Matrix* matrix, uint8_t x, uint8_t y, uint8_t state);

// Set brightness (0-100)
void LEDMX_SetBrightness(LED_Matrix* matrix, uint8_t brightness);

// Load an entire frame
void LEDMX_LoadFrame(LED_Matrix* matrix, uint8_t frame[MATRIX_ROWS]);

// Must be called periodically (from timer interrupt)
void LEDMX_RefreshHandler(LED_Matrix* matrix);

#endif



#endif /* LED_MATRIX_H_ */
